- job:
    name: zuul-jobs-test-add-authorized-keys
    description: Test the add-authorized-keys role
    files:
      - roles/add-authorized-keys/.*
    run: test-playbooks/simple-role-test.yaml
    vars:
      role_name: add-authorized-keys
      public_keys:
        - public_key: |
            ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQChDsP7zEq1JxPLb0Zqj43LIlVoXONCQ1Ko5i9ih/4xm6p0Jn00kpCoVQMb4X2Zys1vWTgpd+r9C/ZoYPFeWuQ8rPCbw4VsocMdwkz7mCPkMDVyPwERjRgt1sTl9WGgtlm2zq/76bmEpuY6PM+nFtJS7UE4XlfoHFK3pR/hgMFi8CX/ILAdtpU96dW2vmXkUt5yj05GHMXKeSU+B5pUEsERgQknH3JBdc/jvKv9dg5zt0jPM6hu5iwgIbMNHydxg4huFO6gKuP+mCNQctK23VMxVXSOYivx8qxu4uzGnBZna01Gi8mY5An4mIQTdcO3KpppOceoDjfEFIOiOnBVoggH testkey

- job:
    name: zuul-jobs-test-add-gpgkey
    description: Test the add-gpgkey role
    files:
      - roles/add-gpgkey/.*
    run: test-playbooks/simple-role-test.yaml
    vars:
      role_name: add-gpgkey
      gpg_key:
        private: |
          -----BEGIN PGP PRIVATE KEY BLOCK-----

          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
          skaW7bI=
          =vRs2
          -----END PGP PRIVATE KEY BLOCK-----

- job:
    name: zuul-jobs-test-base-roles
    description: |
      Tests roles in the 'base' job

      These roles are tested together in this job because testing them
      relies on using base-minimal, which avoids running these roles.
      However, for the job to fully function, they all need to have
      been run (once) by the end.
    parent: base-minimal
    tags: all-platforms
    abstract: true
    run: test-playbooks/base-roles/base.yaml
    # Testing of fetch-zuul-cloner and use-cached-repos need this repo
    # in required-projects
    required-projects:
      - opendev/base-jobs
    files:
      - ^roles/configure-mirrors/.*
      - ^roles/configure-mirrors/.*
      - ^roles/emit-job-header/.*
      - ^roles/ensure-output-dirs/.*
      - ^roles/fetch-output/.*
      - ^roles/fetch-zuul-cloner/.*
      - ^roles/set-zuul-log-path-fact/.*
      - ^roles/use-cached-repo/.*
      - ^roles/validate-host/.*
      - ^test-playbooks/base-roles/.*

- job:
    name: zuul-jobs-test-base-roles-centos-7
    description: Tests roles in the 'base' job on centos-7
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: centos-7
          label: centos-7

- job:
    name: zuul-jobs-test-base-roles-debian-stretch
    description: Tests roles in the 'base' job on debian-stretch
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: debian-stretch
          label: debian-stretch

- job:
    name: zuul-jobs-test-base-roles-fedora-29
    description: Tests roles in the 'base' job on fedora-29
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: fedora-29
          label: fedora-29

- job:
    name: zuul-jobs-test-base-roles-gentoo-17-0-systemd
    description: Tests roles in the 'base' job on gentoo-17-0-systemd
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: gentoo-17-0-systemd
          label: gentoo-17-0-systemd

- job:
    name: zuul-jobs-test-base-roles-opensuse-15
    description: Tests roles in the 'base' job on opensuse-15
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: opensuse-15
          label: opensuse-15

- job:
    name: zuul-jobs-test-base-roles-opensuse-tumbleweed
    description: Tests roles in the 'base' job on opensuse-tumbleweed
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: opensuse-tumbleweed
          label: opensuse-tumbleweed

- job:
    name: zuul-jobs-test-base-roles-ubuntu-bionic
    description: Tests roles in the 'base' job on ubuntu-bionic
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: ubuntu-bionic
          label: ubuntu-bionic

- job:
    name: zuul-jobs-test-base-roles-ubuntu-trusty
    description: Tests roles in the 'base' job on ubuntu-trusty
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: ubuntu-trusty
          label: ubuntu-trusty

- job:
    name: zuul-jobs-test-base-roles-ubuntu-xenial
    description: Tests roles in the 'base' job on ubuntu-xenial
    parent: zuul-jobs-test-base-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: ubuntu-xenial
          label: ubuntu-xenial

- job:
    name: zuul-jobs-test-dstat-graph
    description: Test the dstat-graph roles
    run: test-playbooks/dstat-graph.yaml
    files:
      - ^roles/ensure-dstat-graph/.*
      - ^roles/run-dstat/.*
      - ^roles/dstat-graph/.*
      - ^test-playbooks/dstat-graph.yaml

- job:
    name: zuul-jobs-test-multinode-roles
    description: |
      Tests multinode setup roles

      These roles are tested together in this job because they
      interact with each other.
    tags: all-platforms-multinode
    abstract: true
    run: test-playbooks/multinode/multinode.yaml
    files:
      - ^roles/multi-node-bridge/.*
      - ^roles/multi-node-firewall/.*
      - ^roles/multi-node-hosts-file/.*
      - ^roles/multi-node-known-hosts/.*
      - ^roles/persistent-firewall/.*
      - ^test-playbooks/multinode/.*

- job:
    name: zuul-jobs-test-multinode-roles-centos-7
    description: Tests multinode setup roles on centos-7
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: centos-7
        - name: secondary
          label: centos-7
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-debian-stretch
    description: Tests multinode setup roles on debian-stretch
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: debian-stretch
        - name: secondary
          label: debian-stretch
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-fedora-29
    description: Tests multinode setup roles on fedora-29
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: fedora-29
        - name: secondary
          label: fedora-29
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-gentoo-17-0-systemd
    description: Tests multinode setup roles on gentoo-17-0-systemd
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: gentoo-17-0-systemd
        - name: secondary
          label: gentoo-17-0-systemd
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-opensuse-15
    description: Tests multinode setup roles on opensuse-15
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: opensuse-15
        - name: secondary
          label: opensuse-15
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-opensuse-tumbleweed
    description: Tests multinode setup roles on opensuse-tumbleweed
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: opensuse-tumbleweed
        - name: secondary
          label: opensuse-tumbleweed
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-ubuntu-bionic
    description: Tests multinode setup roles on ubuntu-bionic
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: ubuntu-bionic
        - name: secondary
          label: ubuntu-bionic
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-ubuntu-trusty
    description: Tests multinode setup roles on ubuntu-trusty
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: ubuntu-trusty
        - name: secondary
          label: ubuntu-trusty
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-multinode-roles-ubuntu-xenial
    description: Tests multinode setup roles on ubuntu-xenial
    parent: zuul-jobs-test-multinode-roles
    tags: auto-generated
    nodeset:
      nodes:
        - name: primary
          label: ubuntu-xenial
        - name: secondary
          label: ubuntu-xenial
      groups:
        - name: switch
          nodes:
            - primary
        - name: peers
          nodes:
            - secondary

- job:
    name: zuul-jobs-test-upload-git-mirror
    description: Test the upload-git-mirror role
    run: test-playbooks/upload-git-mirror.yaml
    files:
      - ^roles/upload-git-mirror/.*
      - ^test-playbooks/upload-git-mirror.yaml

- project:
    check:
      jobs: &id001
        - zuul-jobs-test-add-authorized-keys
        - zuul-jobs-test-add-gpgkey
        - zuul-jobs-test-base-roles-centos-7
        - zuul-jobs-test-base-roles-debian-stretch
        - zuul-jobs-test-base-roles-fedora-29
        - zuul-jobs-test-base-roles-gentoo-17-0-systemd
        - zuul-jobs-test-base-roles-opensuse-15
        - zuul-jobs-test-base-roles-opensuse-tumbleweed
        - zuul-jobs-test-base-roles-ubuntu-bionic
        - zuul-jobs-test-base-roles-ubuntu-trusty
        - zuul-jobs-test-base-roles-ubuntu-xenial
        - zuul-jobs-test-dstat-graph
        - zuul-jobs-test-multinode-roles-centos-7
        - zuul-jobs-test-multinode-roles-debian-stretch
        - zuul-jobs-test-multinode-roles-fedora-29
        - zuul-jobs-test-multinode-roles-gentoo-17-0-systemd
        - zuul-jobs-test-multinode-roles-opensuse-15
        - zuul-jobs-test-multinode-roles-opensuse-tumbleweed
        - zuul-jobs-test-multinode-roles-ubuntu-bionic
        - zuul-jobs-test-multinode-roles-ubuntu-trusty
        - zuul-jobs-test-multinode-roles-ubuntu-xenial
        - zuul-jobs-test-upload-git-mirror
    gate:
      jobs: *id001
